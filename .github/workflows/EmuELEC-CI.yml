#
# This is free software.
# 

name: EmuELEC-CI

on:
  watch:
    types: started
  push:
    tags:
        -.*
    # branches: 
        # - master
  # schedule:
    # - cron: 0 20 * * *
  # release:
    # types: [published]

jobs:

  build_emuelec:

    name: Build EmuELEC
    runs-on: ubuntu-latest
    if: github.event.repository.owner.id == github.event.sender.id

    steps:

      - name: Checkout
        uses: actions/checkout@master
        with:
          ref: master

      - name: Prepare
        env:
          DEBIAN_FRONTEND: noninteractive
        run: |
            sudo rm -rf /usr/share/dotnet /var/lib/mysql /etc/php /etc/apt/sources.list.d
            sudo -E apt update && sudo apt upgrade
            sudo -E apt-get -y install gcc make git unzip wget xz-utils libsdl2-dev libsdl2-mixer-dev libfreeimage-dev libfreetype6-dev libcurl4-openssl-dev rapidjson-dev libasound2-dev libgl1-mesa-dev build-essential libboost-all-dev cmake fonts-droid-fallback libvlc-dev libvlccore-dev vlc-bin texinfo premake4 golang
            sudo -E apt-get -y autoremove --purge
            sudo -E apt-get clean
          
      - name: Compile firmware
        run: |
          PROJECT=Amlogic ARCH=arm DISTRO=EmuELEC make image

      - name: Upload firmware
        uses: actions/upload-artifact@master
        with:
          name: EmuELEC
          path: ./repo
